\doxysection{OV5640\+\_\+camera.\+h}
\hypertarget{_o_v5640__camera_8h_source}{}\label{_o_v5640__camera_8h_source}\index{src/hardware/OV5640\_camera.h@{src/hardware/OV5640\_camera.h}}
\mbox{\hyperlink{_o_v5640__camera_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Rename\ camera's\ sensor\_t\ to\ avoid\ conflict\ with\ Adafruit}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#define\ sensor\_t\ camera\_sensor\_t}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}esp\_camera.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#undef\ sensor\_t}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}img\_converters.h"{}}\ \ \ \textcolor{comment}{//\ fmt2rgb888()}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_o_v5640_camera_ab973e1e4426203c6f2f5d2ffdc320c94}{OV5640Camera}}\ \{}
\DoxyCodeLine{00011\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{comment}{//\ Constructor\ allows\ overriding\ LED\ threshold\ if\ needed}}
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{class_o_v5640_camera_ab973e1e4426203c6f2f5d2ffdc320c94}{OV5640Camera}}(uint16\_t\ \mbox{\hyperlink{main_8cpp_ad269aac01e7c58c2bfc634fbef929289}{ledThreshold}}\ =\ 760);}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{comment}{//\ Initialize\ the\ camera\ with\ hardcoded\ pin\ config\ (matches\ your\ wiring)}}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_o_v5640_camera_ac87dd5dee641456216b51c8028d264df}{begin}}();}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{comment}{//\ ─────────────────────────────────────────────}}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{comment}{//\ 1)\ Capture\ +\ find\ LED\ error}}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{comment}{//\ ─────────────────────────────────────────────}}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{comment}{//\ -\/\ Captures\ a\ frame\ (fb\_out)}}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{comment}{//\ -\/\ Computes\ X\_err,\ Y\_err\ =\ centroid\ -\/\ frame\_center}}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{comment}{//\ -\/\ Sets\ has\_led\ =\ true\ if\ LED\ found,\ false\ otherwise}}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{comment}{//\ Caller\ is\ responsible\ for\ later\ calling\ returnFrame(fb\_out).}}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_o_v5640_camera_a7e99b45e156cd19be394ae60d3e7bad9}{captureAndFindError}}(camera\_fb\_t*\&\ fb\_out,}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int16\_t\ \&x\_err,}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int16\_t\ \&y\_err,}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \&has\_led);}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{comment}{//\ ─────────────────────────────────────────────}}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//\ 2)\ Send\ frame\ +\ error\ over\ serial}}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{//\ ─────────────────────────────────────────────}}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{comment}{//\ Sends:}}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{//\ \ \ "{}IMG"{}\ +\ [4-\/byte\ JPEG\ length]\ +\ JPEG\ bytes\ +\ [X\_err,\ Y\_err]}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ -\/\ If\ has\_led\ ==\ false,\ sends\ sentinel\ 0xFFFF,0xFFFF.}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{comment}{//\ -\/\ X\_err,\ Y\_err\ are\ sent\ as\ signed\ 16-\/bit\ big-\/endian.}}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_o_v5640_camera_a4dfc87f1ea8798dc711540c941b29c33}{sendFrameWithError}}(Stream\ \&out,}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ camera\_fb\_t*\ fb,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_led,}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int16\_t\ x\_err,}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int16\_t\ y\_err);}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{comment}{//\ Explicitly\ return\ a\ frame\ buffer\ to\ the\ driver}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_o_v5640_camera_adeed08e9a61d4ff00c594eec0c8a8143}{returnFrame}}(camera\_fb\_t*\ fb);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{comment}{//\ Compute\ X\_err,\ Y\_err\ for\ the\ LED\ relative\ to\ frame\ center}}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ (used\ internally\ but\ public\ in\ case\ you\ want\ it)}}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_o_v5640_camera_ad7d44e77c4800d4f0a59576004b52cce}{findLedError}}(\textcolor{keyword}{const}\ camera\_fb\_t*\ fb,\ int16\_t\ \&x\_err,\ int16\_t\ \&y\_err);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ Convenience:\ old\ one-\/shot\ behavior\ (capture\ +\ send\ +\ return)}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_o_v5640_camera_aec609a03450ca5428e17142087cc5080}{captureLedFrame}}(Stream\ \&out);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ Change\ threshold\ at\ runtime}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_o_v5640_camera_a2766050b9915f10a65814e6eede4dfa5}{setLedThreshold}}(uint16\_t\ thr)\ \{\ \_ledThresh\ =\ thr;\ \}}
\DoxyCodeLine{00059\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{class_o_v5640_camera_aa4ef452b65e7185028a72b501d138c3c}{getLedThreshold}}()\textcolor{keyword}{\ const\ \ \ }\{\ \textcolor{keywordflow}{return}\ \_ledThresh;\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00062\ \ \ \ \ camera\_config\_t\ \_config\{\};}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{bool}\ \_initialized\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00064\ \ \ \ \ uint16\_t\ \_ledThresh;}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{void}\ fillDefaultConfig();}
\DoxyCodeLine{00067\ \};}

\end{DoxyCode}
