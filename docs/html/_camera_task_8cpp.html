<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sport Trackr Design Review: src/tasks/CameraTask.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Sport Trackr Design Review<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">A sophisticated dual-axis motor control system that automatically tracks LED targets using computer vision feedback. The system combines real-time image processing, inertial measurement, and PID control to enable autonomous tracking or manual teleoperation via a web interface.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_camera_task_8cpp.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">CameraTask.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of LED detection and visual servoing error computation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_f_s_m_8h_source.html">../fsm/FSM.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_state_8h_source.html">../fsm/State.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_camera_task_8h_source.html">CameraTask.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa4f3a74fdc57aa9bd8666a9a682e75cd" id="r_aa4f3a74fdc57aa9bd8666a9a682e75cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa4f3a74fdc57aa9bd8666a9a682e75cd">camera_task_func</a> (void *arg)</td></tr>
<tr class="memdesc:aa4f3a74fdc57aa9bd8666a9a682e75cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">FreeRTOS task entry point for camera vision processing.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of LED detection and visual servoing error computation. </p>
<p>This file implements real-time computer vision processing for LED target tracking. It captures frames from the OV5640 camera, detects bright LED targets using brightness thresholding, calculates centroid positions, and computes pixel errors for visual servoing control.</p>
<p>Computer Vision Algorithm:</p><ol type="1">
<li>Capture frame from OV5640 camera (QVGA or configured resolution)</li>
<li>Scan all pixels for brightness above threshold</li>
<li>Calculate weighted centroid (center of mass) of bright pixels</li>
<li>Compute pixel errors from image center: (centroid - center)</li>
<li>Publish errors and detection status via Share&lt;T&gt; objects</li>
<li>Optionally stream frame to UI for visualization</li>
</ol>
<p>Operating Modes:</p><ul>
<li><b>WAIT</b>: Camera idle, no capture (power saving)</li>
<li><b>CAP_SEND_ERR</b>: Capture and compute errors only (fast, no streaming)</li>
<li><b>CAP_SEND_RETURN</b>: Full mode with frame streaming to UI (slower)</li>
</ul>
<p>Performance Optimization:</p><ul>
<li>CAP_SEND_ERR mode skips frame transmission for maximum frame rate</li>
<li>Brightness threshold configurable via ledThreshold share</li>
<li>Centroid weighted by pixel intensity for sub-pixel accuracy</li>
</ul>
<p>Data Output:</p><ul>
<li>pan_err: Horizontal pixel error (negative = LED left of center)</li>
<li>tilt_err: Vertical pixel error (negative = LED above center) <br  />
</li>
<li>hasLed: Boolean detection flag (true when LED found in frame)</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>Computer Vision Team </dd></dl>
<dl class="section date"><dt>Date</dt><dd>December 2025 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.2</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="_camera_task_8h.html" title="Computer vision task for LED detection and tracking error computation.">CameraTask.h</a> for class interface and mode descriptions </dd>
<dd>
<a class="el" href="_o_v5640__camera_8h.html">OV5640_camera.h</a> for <a class="el" href="main_8cpp.html#a75f0a8d83ec4ecf50ce67b9df42431e7">camera</a> hardware interface </dd></dl>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="aa4f3a74fdc57aa9bd8666a9a682e75cd" name="aa4f3a74fdc57aa9bd8666a9a682e75cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4f3a74fdc57aa9bd8666a9a682e75cd">&#9670;&#160;</a></span>camera_task_func()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void camera_task_func </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>arg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FreeRTOS task entry point for camera vision processing. </p>
<p>C-style function required by xTaskCreate(). Creates an infinite loop that periodically calls the camera task's update() method to execute the <a class="el" href="class_f_s_m.html">FSM</a>.</p>
<p>Task Loop:</p><ol type="1">
<li>Call update() to execute current <a class="el" href="class_f_s_m.html">FSM</a> state</li>
<li>Delay for 10ms (100Hz maximum frame rate)</li>
<li>Repeat indefinitely</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>Pointer to <a class="el" href="class_camera_task.html" title="Real-time LED detection and visual servoing error computation.">CameraTask</a> object (cast from void*)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Fixed 10ms delay provides ~100Hz maximum frame rate </dd>
<dd>
Actual frame rate depends on camera capture time and processing </dd>
<dd>
Task never exits - runs for lifetime of system </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_b118c466441e8db851de69c6796245a3.html">tasks</a></li><li class="navelem"><a href="_camera_task_8cpp.html">CameraTask.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
