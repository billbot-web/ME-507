<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tracker Teleop (Mock)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:system-ui,sans-serif;margin:16px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
    #video{max-width:100%;border:1px solid #ccc}
    #tel{font-family:ui-monospace,monospace;white-space:pre;background:#f7f7f7;padding:8px;border-radius:8px}
    button,input{width:100%;margin:6px 0}
    .row{display:flex;gap:8px}
  </style>
</head>
<body>
  <h1>Sport Tracker – Teleop (Mock)</h1>
  <div class="grid">
    <div>
      <!-- Placeholder picture so you see *something* -->
      <img id="video" src="https://picsum.photos/640/360" alt="video mock">
    </div>
    <div>
      <div class="row">
        <button id="teleopBtn">TELEOP</button>
        <button id="holdBtn">HOLD</button>
        <button id="stopBtn">STOP</button>
      </div>
      <label>Telemetry rate (Hz)
        <input type="number" id="hz" value="30" min="1" max="200">
      </label>
      <button id="applyHz">Apply</button>
      <h3>Telemetry</h3>
      <div id="tel">—</div>
      <p><small>Keyboard: A/D = pan, W/S = tilt, Shift = boost. (Mock data only)</small></p>
    </div>
  </div>

  <script>
    // ---- MOCK WEBSOCKET (no ESP needed) ----
    const ws = { readyState:1, send: (o)=>console.log("send→", o), onmessage:null };
    let hz = 30, timer = null;
    const telDiv = document.getElementById('tel');

    function startMock() {
      if (timer) clearInterval(timer);
      timer = setInterval(()=>{
        const now = Date.now()/1000;
        const mock = {
          t: now,
          enc: {pan_cnt: Math.floor(10000+500*Math.sin(now)), tilt_cnt: Math.floor(-2000+300*Math.cos(now))},
          enc_deg: {pan: 10*Math.sin(now*0.8), tilt: -6*Math.cos(now*0.7)},
          mot: {pan_ma: 250+50*Math.sin(now*1.3), tilt_ma: 220+45*Math.cos(now*1.1), pan_pwm: 128, tilt_pwm: 120},
          imu: {roll: 1.2, pitch: 0.3, yaw: (now*20)%360, gx:0.1, gy:-0.2, gz:0.05},
          status: {mode: currentMode, vbat: 7.9, temp_c: 36.5}
        };
        telDiv.textContent = JSON.stringify(mock, null, 2);
      }, 1000/Math.max(1,hz));
    }

    // Mode buttons (mock handlers)
    let currentMode = "STOP";
    document.getElementById('teleopBtn').onclick = ()=>{ currentMode="TELEOP"; };
    document.getElementById('holdBtn').onclick   = ()=>{ currentMode="HOLD"; };
    document.getElementById('stopBtn').onclick   = ()=>{ currentMode="STOP"; };
    document.getElementById('applyHz').onclick   = ()=>{
      hz = parseInt(document.getElementById('hz').value||30,10);
      startMock();
    };

    // Keyboard teleop (mock)
    const keys = { w:false, s:false, a:false, d:false, shift:false };
    addEventListener('keydown', e=> setKey(e.key.toLowerCase(), true));
    addEventListener('keyup',   e=> setKey(e.key.toLowerCase(), false));
    function setKey(k, v){ if(k in keys) keys[k]=v; }

    setInterval(()=>{
      let pan=0, tilt=0;
      if (keys.a) pan -= 1;
      if (keys.d) pan += 1;
      if (keys.w) tilt += 1;
      if (keys.s) tilt -= 1;
      const base = 60*(keys.shift?2:1);
      ws.send(JSON.stringify({cmd:"teleop", pan_rate_dps: pan*base, tilt_rate_dps: tilt*base}));
    }, 33);

    startMock();
  </script>
</body>
</html>
